

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inferlo and libDAI comparison &mdash; InferLO 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=eea1f72d" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bucket renormalization" href="bucket_renormalization.html" />
    <link rel="prev" title="Getting started with InferLO" href="../tutorials/getting_started.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            InferLO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing InferLO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/getting_started.html">Getting started with InferLO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Experiments</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Inferlo and libDAI comparison</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#1.-Marginal-probabilities-on-trees">1. Marginal probabilities on trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Maximal-likelihood-on-trees">2. Maximal likelihood on trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Marginal-probabilities-with-junction-tree">3. Marginal probabilities with junction tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="#4.-Marginal-probabilities-for-the-grid-graph">4. Marginal probabilities for the grid graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Maximal-likelihood-for-the-grid-graph">5. Maximal likelihood for the grid graph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bucket_renormalization.html">Bucket renormalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="marginal_probabilities.html">Marginal Probabilities with Elimination algorithms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to InferLO</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">InferLO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Inferlo and libDAI comparison</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/experiments/inferlo_libdai.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Inferlo-and-libDAI-comparison">
<h1>Inferlo and libDAI comparison<a class="headerlink" href="#Inferlo-and-libDAI-comparison" title="Link to this heading">ÔÉÅ</a></h1>
<p>In this Notebook we compare several algorithms in InferLO and libDAI in terms of accuracy and performance.</p>
<p>This notebook is also useful as example of how to use libDAI interop.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inferlo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">inferlo.pairwise.testing</span><span class="w"> </span><span class="kn">import</span> <span class="n">tree_potts_model</span><span class="p">,</span> <span class="n">grid_potts_model</span><span class="p">,</span> <span class="n">cross_potts_model</span><span class="p">,</span> <span class="n">assert_results_close</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">inferlo.interop</span><span class="w"> </span><span class="kn">import</span> <span class="n">LibDaiInterop</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Charts</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alg_name</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time, s&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">time</span>
        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">error</span>
        <span class="k">if</span> <span class="n">acc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">acc</span>
        <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">alg_name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gr_size</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">cnt</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">charts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">alg_name</span> <span class="ow">in</span> <span class="n">charts</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">charts</span><span class="p">[</span><span class="n">alg_name</span><span class="p">])</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">alg_name</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Model size&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">libdai</span> <span class="o">=</span> <span class="n">LibDaiInterop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="1.-Marginal-probabilities-on-trees">
<h2>1. Marginal probabilities on trees<a class="headerlink" href="#1.-Marginal-probabilities-on-trees" title="Link to this heading">ÔÉÅ</a></h2>
<p>We solve a problem of finding marginal probabilities for random pairwise model on a tree with variables taking 5 possible values. We use 2 exact algorithms: ‚Äòtree_dp‚Äô (dynamic programming on a tree) from InferLO and ‚ÄòBP‚Äô (<a class="reference external" href="https://staff.fnwi.uva.nl/j.m.mooij/libDAI/doc/classdai_1_1BP.html">belief propagation</a>) from libDAI. We check that they give the same results and measure running time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">charts</span> <span class="o">=</span> <span class="n">Charts</span><span class="p">()</span>

<span class="k">for</span> <span class="n">gr_size</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">*</span> <span class="mi">50</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tree_potts_model</span><span class="p">(</span><span class="n">gr_size</span><span class="o">=</span><span class="n">gr_size</span><span class="p">,</span> <span class="n">al_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">true_result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;tree_dp&#39;</span><span class="p">)</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;inferlo-tree_dp&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">libdai</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;BP&#39;</span><span class="p">)</span>
    <span class="n">assert_results_close</span> <span class="p">(</span><span class="n">true_result</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">log_pf_tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;libDAI-BP&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">libdai</span><span class="o">.</span><span class="n">true_running_time</span><span class="p">)</span>

<span class="n">charts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/experiments_inferlo_libdai_4_0.png" src="../_images/experiments_inferlo_libdai_4_0.png" />
</div>
</div>
</section>
<section id="2.-Maximal-likelihood-on-trees">
<h2>2. Maximal likelihood on trees<a class="headerlink" href="#2.-Maximal-likelihood-on-trees" title="Link to this heading">ÔÉÅ</a></h2>
<p>We solve a problem of finding most probable state for random pairwise model on a tree with variables taking 5 possible values. We use 2 exact algorithms: ‚Äòtree_dp‚Äô (dynamic programming on a tree) from InferLO and ‚ÄòBP‚Äô (<a class="reference external" href="https://staff.fnwi.uva.nl/j.m.mooij/libDAI/doc/classdai_1_1BP.html">belief propagation</a>) from libDAI. We check that they give the same results and measure running time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">charts</span> <span class="o">=</span> <span class="n">Charts</span><span class="p">()</span>

<span class="k">for</span> <span class="n">gr_size</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="o">*</span> <span class="mi">50</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tree_potts_model</span><span class="p">(</span><span class="n">gr_size</span><span class="o">=</span><span class="n">gr_size</span><span class="p">,</span> <span class="n">al_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">true_result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">max_likelihood</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;tree_dp&#39;</span><span class="p">)</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;inferlo-tree_dp&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">libdai</span><span class="o">.</span><span class="n">max_likelihood</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;BP&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">true_result</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;libDAI-BP&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">libdai</span><span class="o">.</span><span class="n">true_running_time</span><span class="p">)</span>

<span class="n">charts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/experiments_inferlo_libdai_6_0.png" src="../_images/experiments_inferlo_libdai_6_0.png" />
</div>
</div>
</section>
<section id="3.-Marginal-probabilities-with-junction-tree">
<h2>3. Marginal probabilities with junction tree<a class="headerlink" href="#3.-Marginal-probabilities-with-junction-tree" title="Link to this heading">ÔÉÅ</a></h2>
<p>We generate binary graphical model on a ‚Äúcross‚Äù graph, which is graph of bounded treewidth, and find marginal probabilities for it using junction tree algorithms from InferLO and libDAI (<a class="reference external" href="https://staff.fnwi.uva.nl/j.m.mooij/libDAI/doc/classdai_1_1JTree.html">JTREE</a>).</p>
<p>We check that results are identical and plot running time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">charts</span> <span class="o">=</span> <span class="n">Charts</span><span class="p">()</span>
<span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">cross_potts_model</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">al_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">gr_size</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">gr_size</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;junction_tree&#39;</span><span class="p">)</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;inferlo&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span>

    <span class="n">result2</span> <span class="o">=</span> <span class="n">libdai</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;JTREE&#39;</span><span class="p">)</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;libDAI&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">libdai</span><span class="o">.</span><span class="n">true_running_time</span><span class="p">)</span>

    <span class="n">inferlo</span><span class="o">.</span><span class="n">pairwise</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_results_close</span><span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">,</span> <span class="n">log_pf_tol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">)</span>

<span class="n">charts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/experiments_inferlo_libdai_8_0.png" src="../_images/experiments_inferlo_libdai_8_0.png" />
</div>
</div>
</section>
<section id="4.-Marginal-probabilities-for-the-grid-graph">
<h2>4. Marginal probabilities for the grid graph<a class="headerlink" href="#4.-Marginal-probabilities-for-the-grid-graph" title="Link to this heading">ÔÉÅ</a></h2>
<p>We consider binary pairwise model on a grid of size 5xN.</p>
<p>We use different (exact and approximate) InferLO and libDAI algorithms to calculate marginal probabilities. We measure running time and error. Error is maximal difference betwen true and calculated marginal probability over all variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">charts</span> <span class="o">=</span> <span class="n">Charts</span><span class="p">()</span>
<span class="k">for</span> <span class="n">width</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">grid_potts_model</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">al_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">gr_size</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">gr_size</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">true_result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;path_dp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">marg_prob</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;inferlo-path_dp&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;junction_tree&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_field&#39;</span><span class="p">,</span> <span class="s1">&#39;message_passing&#39;</span><span class="p">]:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="n">algo</span><span class="p">)</span><span class="o">.</span><span class="n">marg_prob</span>
        <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;inferlo-&quot;</span> <span class="o">+</span> <span class="n">algo</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">result</span><span class="o">-</span><span class="n">true_result</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="s1">&#39;FBP&#39;</span><span class="p">,</span> <span class="s1">&#39;HAK&#39;</span><span class="p">,</span> <span class="s1">&#39;JTREE&#39;</span><span class="p">,</span> <span class="s1">&#39;MF&#39;</span><span class="p">,</span> <span class="s1">&#39;TRWBP&#39;</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">libdai</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">algo</span><span class="p">)</span><span class="o">.</span><span class="n">marg_prob</span>
        <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;libDAI-&quot;</span> <span class="o">+</span> <span class="n">algo</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">libdai</span><span class="o">.</span><span class="n">true_running_time</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">result</span><span class="o">-</span><span class="n">true_result</span><span class="p">)))</span>

<span class="n">charts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/experiments_inferlo_libdai_10_0.png" src="../_images/experiments_inferlo_libdai_10_0.png" />
</div>
</div>
</section>
<section id="5.-Maximal-likelihood-for-the-grid-graph">
<h2>5. Maximal likelihood for the grid graph<a class="headerlink" href="#5.-Maximal-likelihood-for-the-grid-graph" title="Link to this heading">ÔÉÅ</a></h2>
<p>We solve a problem of finding most probable state for random pairwise model on a 5xN grid. We measure running time and accuracy. Accuracy is the number of correctly guessed variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">acc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">charts</span> <span class="o">=</span> <span class="n">Charts</span><span class="p">()</span>
<span class="k">for</span> <span class="n">width</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">grid_potts_model</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">al_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">gr_size</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">gr_size</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">true_ml</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">max_likelihood</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;path_dp&#39;</span><span class="p">)</span>
    <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;inferlo-path_dp&quot;</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;junction_tree&#39;</span><span class="p">]:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ml</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">max_likelihood</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="n">algo</span><span class="p">)</span>
        <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;inferlo-&quot;</span> <span class="o">+</span> <span class="n">algo</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="n">acc</span><span class="p">(</span><span class="n">true_ml</span><span class="p">,</span> <span class="n">ml</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="s1">&#39;FBP&#39;</span><span class="p">,</span> <span class="s1">&#39;DECMAP&#39;</span><span class="p">,</span> <span class="s1">&#39;GIBBS&#39;</span><span class="p">,</span> <span class="s1">&#39;JTREE&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">gr_size</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="n">algo</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GIBBS&#39;</span><span class="p">,</span> <span class="s1">&#39;DECMAP&#39;</span><span class="p">,</span> <span class="s1">&#39;FBP&#39;</span><span class="p">]:</span>
            <span class="k">continue</span>

        <span class="n">ml</span> <span class="o">=</span> <span class="n">libdai</span><span class="o">.</span><span class="n">max_likelihood</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">algo</span><span class="p">)</span>
        <span class="n">charts</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="s2">&quot;libDAI-&quot;</span> <span class="o">+</span> <span class="n">algo</span><span class="p">,</span> <span class="n">gr_size</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">libdai</span><span class="o">.</span><span class="n">true_running_time</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="n">acc</span><span class="p">(</span><span class="n">true_ml</span><span class="p">,</span> <span class="n">ml</span><span class="p">))</span>

<span class="n">charts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5
25
50
100
250
375
500
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/experiments_inferlo_libdai_12_1.png" src="../_images/experiments_inferlo_libdai_12_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../tutorials/getting_started.html" class="btn btn-neutral float-left" title="Getting started with InferLO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bucket_renormalization.html" class="btn btn-neutral float-right" title="Bucket renormalization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, InferLO developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>